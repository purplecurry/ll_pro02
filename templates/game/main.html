{% extends 'game/base.html' %}
{% load static %}
{% load number_filters %}

{% block title %}ìœ ë‹ˆì½˜ ë©”ì´ì»¤ - ëŒ€ë°• ì•„ë‹ˆë©´ ìª½ë°•!{% endblock %}

{% block content %}
<div class="main-page">
    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
        </div>
    </div>
    <!-- íˆì–´ë¡œ ì„¹ì…˜ -->
    <section class="hero">
        <h1>ğŸ¦„ ìœ ë‹ˆì½˜ ë©”ì´ì»¤</h1>
        <p class="slogan">ëŒ€ë°• ì•„ë‹ˆë©´ ìª½ë°•! ë‹¹ì‹ ì˜ ì„ íƒì€?</p>
        
        {% if user.is_authenticated %}
            {% if active_session %}
                <!-- ì§„í–‰ ì¤‘ì¸ ê²Œì„ ìˆìŒ -->
                <a href="{% url 'game:play' session_id=active_session.pk %}" class="btn btn-primary" onclick="showLoading()">
                    ğŸ® ê²Œì„ ê³„ì†í•˜ê¸°
                </a>
                <p class="session-info">
                    ë‚¨ì€ ìë³¸: {{ active_session.current_capital|korean_currency }} | 
                    ë‚¨ì€ ê¸°íšŒ: {{ active_session.remaining_chances }}íšŒ
                </p>
            {% else %}
                <!-- ìƒˆ ê²Œì„ ì‹œì‘ -->
                <a href="{% url 'game:game_start' %}" class="btn btn-primary" onclick="showLoading()">
                    ğŸš€ ê²Œì„ ì‹œì‘
                </a>
            {% endif %}
        {% else %}
            <!-- ë¹„ë¡œê·¸ì¸ -->
            <a href="{% url 'game:login' %}" class="btn btn-primary">ë¡œê·¸ì¸í•˜ê³  ì‹œì‘</a>
            <a href="{% url 'game:signup' %}" class="btn btn-secondary">íšŒì›ê°€ì…</a>
        {% endif %}
    </section>

    <!-- ì˜¤ëŠ˜ì˜ Top 3 -->
    <div class="main-grid">
        <section class="how-to-play">
            <h2>ğŸ¯ ê²Œì„ ë°©ë²•</h2>
            <div class="how-to-play2">
                <p><span class="emoji-number">1ï¸âƒ£</span>ì‹œì‘ ìë³¸ê¸ˆ 1ì–µì›!<br>5ë²ˆì˜ íˆ¬ì ê¸°íšŒ!</p>
                <p><span class="emoji-number">2ï¸âƒ£</span>ì°½ì—…ê°€ë§ˆë‹¤ ë‹¤ë¥¸<br>ë“±ì¥í™•ë¥  ë° ìˆ˜ìµë¥ !</p> 
                <p><span class="emoji-number">3ï¸âƒ£</span>ì„±ê³µ ì‹œ ìµœëŒ€ 5000%<br>ì´ˆëŒ€ë°• ìˆ˜ìµ!</p>
                <p><span class="emoji-number">4ï¸âƒ£</span>ì‹¤íŒ¨ ì‹œ íˆ¬ìê¸ˆ<br>ì „ì•¡ ì†ì‹¤!</p>
                <p><span class="emoji-number">5ï¸âƒ£</span>2ì²œë§Œì›ìœ¼ë¡œ<br>ì„±ê³µí™•ë¥  UP!</p>
            </div>
        </section>     
        <section class="top3-section">
            <h2>ğŸ† ì˜¤ëŠ˜ì˜ Top 3</h2>
            {% if top3 %}
                <div class="top3-list">
                    {% for session in top3 %}
                    <div class="top3-item rank-{{ forloop.counter }}">
                        <span class="rank">{{ forloop.counter }}</span>                    
                        <div class="profile-image">
                        {% if user.img_profile %}
                            <img src="{{ user.img_profile.url }}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
                        {% else %}
                            <div class="default-avatar">ğŸ‘¤</div>
                        {% endif %}
                        </div>
                        <span class="nickname">{{ session.user.nickname }}</span>
                        <span class="profit {% if session.final_profit_rate >= 0 %}positive{% else %}negative{% endif %}">{{ session.final_profit_rate|floatformat:1 }}%</span>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>ì•„ì§ ì˜¤ëŠ˜ì˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ íˆ¬ìë¥¼ ì‹œì‘í•˜ì„¸ìš”!</p>
            {% endif %}
            <a href="{% url 'game:ranking' %}" class="btn btn-link">ì „ì²´ ë­í‚¹ ë³´ê¸° â†’</a>
        </section>
    </div>
    <!-- ê²Œì„ ë°©ë²•, ìºë¦­í„° ì†Œê°œ ì„¹ì…˜ -->
       
    <section class="intro-characters">
        <h2>ğŸ’¼ ì°½ì—…ê°€ ì†Œê°œ</h2>
        <div class="character-slider">
            <button class="slider-btn prev-btn" onclick="changeCharacter(-1)">â€¹</button>
            
            <div class="character-cards">
                <!-- ê¹€ì¼ë¯¼ (jaemin) -->
                <div class="character-card active">
                    <div class="character-image">
                        <img src="{% static 'images/characters/jaemin.png' %}" alt="ê¹€ì¼ë¯¼">
                    </div>
                    <h3 class="character-name">ê¹€ì¼ë¯¼</h3>
                    <p class="character-desc">ê³¼í•™ìƒì ê³ ì¸ë¬¼<br>"ì œ ì•„ì´ë””ì–´ì— íˆ¬ì ì•ˆí•˜ë©´ í›„íšŒí• ê±¸ìš”? ì•¼ë¥´ ã…‹ã…‹"</p>
                    <div class="character-stats">
                        <div class="stat">
                            <span class="stat-label">ë“±ì¥í™•ë¥ </span>
                            <span class="stat-value">â˜…â˜…â˜…â˜†â˜† (25%)</span>
                        </div>
                    </div>
                </div>

                <!-- ì„±ìˆ˜ë™ (hipster) -->
                <div class="character-card">
                    <div class="character-image">
                        <img src="{% static 'images/characters/hipster.png' %}" alt="ì„±ìˆ˜ë™">
                    </div>
                    <h3 class="character-name">ì„±ìˆ˜ë™</h3>
                    <p class="character-desc">y2k ë¹ˆí‹°ì§€ ê°ì„± ì²­ë…„<br>"ìš”ì¦˜ í™í•œ ì‚¬ëŒë“¤ì€ ë‹¤ í•˜ë˜ë°ìš”.. DM ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤ ğŸ™"</p>
                    <div class="character-stats">
                        <div class="stat">
                            <span class="stat-label">ë“±ì¥í™•ë¥ </span>
                            <span class="stat-value">â˜…â˜…â˜…â˜†â˜† (25%)</span>
                        </div>
                    </div>
                </div>

                <!-- ìœ ëŠ¥í•œ (elite) -->
                <div class="character-card">
                    <div class="character-image">
                        <img src="{% static 'images/characters/elite.png' %}" alt="ìœ ëŠ¥í•œ">
                    </div>
                    <h3 class="character-name">ìœ ëŠ¥í•œ</h3>
                    <p class="character-desc">ì»¨ì„¤í„´íŠ¸ ì¶œì‹  ì—˜ë¦¬íŠ¸ ì‚¬ì—…ê°€<br>"ë°ì´í„° ê¸°ë°˜ ë¶„ì„ ê²°ê³¼, ROIëŠ” ì¶©ë¶„íˆ ê²€ì¦ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ìƒì…ë‹ˆë‹¤."</p>
                    <div class="character-stats">
                        <div class="stat">
                            <span class="stat-label">ë“±ì¥í™•ë¥ </span>
                            <span class="stat-value">â˜…â˜…â˜…â˜†â˜† (20%)</span>
                        </div>
                    </div>
                </div>

                <!-- ê³µí•„íƒœ (ai_fan) -->
                <div class="character-card">
                    <div class="character-image">
                        <img src="{% static 'images/characters/ai_fan.png' %}" alt="ê³µí•„íƒœ">
                    </div>
                    <h3 class="character-name">ê³µí•„íƒœ(G.P.T)</h3>
                    <p class="character-desc">AI ê´‘ì‹ ë„ ê°œë°œì<br>"AIê°€ ê³„ì‚°í•œ ì„±ê³µ í™•ë¥ ì€ 99.9%ì…ë‹ˆë‹¤. GPTì˜ ëœ»ëŒ€ë¡œ.."</p>
                    <div class="character-stats">
                        <div class="stat">
                            <span class="stat-label">ë“±ì¥í™•ë¥ </span>
                            <span class="stat-value">â˜…â˜…â˜…â˜†â˜† (25%)</span>
                        </div>
                    </div>
                </div>

                <!-- ì™•ì†Œì‹¬ (shy) -->
                <div class="character-card">
                    <div class="character-image">
                        <img src="{% static 'images/characters/shy.png' %}" alt="ì™•ì†Œì‹¬">
                    </div>
                    <h3 class="character-name">ì™•ì†Œì‹¬</h3>
                    <p class="character-desc">ì†Œì‹¬í•œ ì²œì¬ ë°œëª…ê°€<br>"ì €.. ê·¸ê²Œ.. ì•„ì´ë””ì–´ëŠ” ê´œì°®ì€ ê²ƒ ê°™ì€ë°.. ì—­ì‹œ íˆ¬ìëŠ” ë¬´ë¦¬ê² ì£ .."</p>
                    <div class="character-stats">
                        <div class="stat">
                            <span class="stat-label">ë“±ì¥í™•ë¥ </span>
                            <span class="stat-value">â˜…â˜†â˜†â˜†â˜† (5% í¬ê·€!)</span>
                        </div>
                    </div>
                </div>
            </div>

            <button class="slider-btn next-btn" onclick="changeCharacter(1)">â€º</button>
        </div>

        <!-- ì¸ë””ì¼€ì´í„° -->
        <div class="slider-dots">
            <span class="dot active" onclick="goToCharacter(0)"></span>
            <span class="dot" onclick="goToCharacter(1)"></span>
            <span class="dot" onclick="goToCharacter(2)"></span>
            <span class="dot" onclick="goToCharacter(3)"></span>
            <span class="dot" onclick="goToCharacter(4)"></span>
        </div>
    </section>    

    <script>
    let currentCharacter = 0;
    const totalCharacters = 5;

    function changeCharacter(direction) {
        const cards = document.querySelectorAll('.character-card');
        const dots = document.querySelectorAll('.dot');
        
        // í˜„ì¬ ì¹´ë“œ ë¹„í™œì„±í™”
        cards[currentCharacter].classList.remove('active');
        dots[currentCharacter].classList.remove('active');
        
        // ë‹¤ìŒ ì¸ë±ìŠ¤ ê³„ì‚° (ìˆœí™˜)
        currentCharacter = (currentCharacter + direction + totalCharacters) % totalCharacters;
        
        // ìƒˆ ì¹´ë“œ í™œì„±í™”
        cards[currentCharacter].classList.add('active');
        dots[currentCharacter].classList.add('active');
    }

    function goToCharacter(index) {
        const cards = document.querySelectorAll('.character-card');
        const dots = document.querySelectorAll('.dot');
        
        // í˜„ì¬ ì¹´ë“œ ë¹„í™œì„±í™”
        cards[currentCharacter].classList.remove('active');
        dots[currentCharacter].classList.remove('active');
        
        // ìƒˆ ì¹´ë“œ í™œì„±í™”
        currentCharacter = index;
        cards[currentCharacter].classList.add('active');
        dots[currentCharacter].classList.add('active');
    }

    function showLoading() {
        const messages = [
            "ğŸƒ ì°½ì—…ê°€ê°€ ë¯¸íŒ…ë£¸ìœ¼ë¡œ ë›°ì–´ì˜¤ëŠ” ì¤‘...",
            "ğŸ’¼ ì°½ì—…ê°€ê°€ ì•„ì´ë””ì–´ ë°œí‘œì¤€ë¹„ ì¤‘...",
        ];
        const randomMsg = messages[Math.floor(Math.random() * messages.length)];
        document.querySelector('.loading-text').textContent = randomMsg;
        document.getElementById('loading-overlay').style.display = 'flex';
    }
    </script>
</div>
{% endblock %}