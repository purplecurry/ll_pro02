{% extends 'game/base.html' %}
{% load static %}
{% load number_filters %}

{% block title %}ê²°ê³¼ - ìœ ë‹ˆì½˜ ë©”ì´ì»¤{% endblock %}

{% block content %}
<div class="result-page {% if investment.is_success %}success{% else %}failure{% endif %}">
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
        </div>
    </div>
    <!-- ê²°ê³¼ í—¤ë” -->
    <div class="result-header">
        <div class="result-character-image">
            {% if investment.is_success %}
                <img src="{% static 'images/characters/' %}{{ character_key }}_success.png" alt="{{ investment.character_name }}">
            {% else %}
                <img src="{% static 'images/characters/' %}{{ character_key }}_fail.png" alt="{{ investment.character_name }}">
            {% endif %}
        </div>
        {% if investment.is_success %}
            <h1>ğŸ‰ íˆ¬ì ì„±ê³µ!</h1>
            <p class="profit-rate">+{{ investment.profit_rate }}% ìˆ˜ìµ</p>
        {% else %}
            <h1>ğŸ’€ íˆ¬ì ì‹¤íŒ¨...</h1>
            <p class="profit-rate">-100% ì†ì‹¤</p>
        {% endif %}
    </div>

    <!-- íˆ¬ì ì •ë³´ -->
    <div class="investment-info">
        <p><strong>ìºë¦­í„°:</strong> {{ investment.character_name }}</p>
        <p><strong>ì•„ì´ë””ì–´:</strong> {{ investment.idea_title }}</p>
        <p><strong>íˆ¬ìê¸ˆ:</strong> {{ investment.invest_amount|add_comma }}ë§Œì›</p>
    </div>

    <!-- AI ê²°ê³¼ ë©”ì‹œì§€ -->
    <div class="result-message">
        <div class="system-msg">
            <span class="tag">SYSTEM</span>
            <p>{{ investment.result_system_msg }}</p>
        </div>
        <div class="character-reaction">
            <span class="tag">{{ investment.character_name }}</span>
            <p>{{ investment.result_character_reaction }}</p>
        </div>
    </div>

    <!-- í˜„ì¬ ê²Œì„ ìƒíƒœ -->
    <div class="result-status">
        <div class="result-item">
            <span class="label">ğŸ’° í˜„ì¬ ìë³¸ê¸ˆ</span>
            <span class="value">{{ session.current_capital|korean_currency }}</span>
        </div>
        <div class="result-item">
            <span class="label">ğŸ¯ ë‚¨ì€ ê¸°íšŒ</span>
            <span class="value">{{ session.remaining_chances }}íšŒ</span>
        </div>        
    </div>

    <!-- ë‹¤ìŒ ë²„íŠ¼ -->
    <div class="btn-group">
        {% if session.is_finished %}
            <a href="{% url 'game:ranking' %}" class="btn btn-primary">ğŸ† ë­í‚¹ í™•ì¸</a>
            <a href="{% url 'game:game_start' %}" class="btn btn-secondary">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</a>
        {% else %}
            <a href="{% url 'game:play' session_id=session.pk %}" class="btn btn-primary" onclick="showLoading2()">ë‹¤ìŒ íˆ¬ì â†’</a>
        {% endif %}
    </div>
    <script>
    function showLoading2() {
        const messages = [
        "ğŸƒ ë‹¤ìŒ ì°½ì—…ê°€ê°€ ë¯¸íŒ…ë£¸ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ì¤‘...",
        "ğŸ’¼ ë‹¤ìŒ ì°½ì—…ê°€ê°€ ì•„ì´ë””ì–´ ë°œí‘œì¤€ë¹„ ì¤‘...",
        ];
            
        // ëœë¤ ì„ íƒ
        const randomMsg = messages[Math.floor(Math.random() * messages.length)];
        document.querySelector('.loading-text').textContent = randomMsg;
        document.getElementById('loading-overlay').style.display = 'flex';
    }
    </script>
</div>
{% endblock %}
